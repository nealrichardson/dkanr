---
title: "Getting started with dkanr"
author: "Tony Fujs"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to dkanr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction to dkanr

The `dkanr` package is an R client to the [DKAN REST API](https://dkan.readthedocs.io/en/latest/apis/rest-api.html). Through the DKAN REST API, `dkanr` accesses the available catalog while providing CRUD functionalities.

Some features of this package include:

* Uploading datasets
* Authorized access to catalog
* Updating resources

This document covers the main services of the package and provides instructions on how to best utilize all of its offerings.

## Setting Up Your Connection

Depending on the catalog, you can access its contents with no authentication required. It is important to remember that these URLs are must include `"http://"` or `"https://"`, dependent on the site.

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(dkanr)
dkanr_setup(url = 'http://demo.getdkan.com')
```

For resources with restricted privileges, such as admin or editor rights, and/or required authentication, you must authenticate before accessing the repository. This can be done by including your username and password.

```{r message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
dkanr_setup(url = 'http://demo.getdkan.com',
            username = 'my_username',
            password = 'my_password')
```

The following function prints your step up connection information.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
dkanr_settings()
```

## CRUD Functions
For most data warehouses and repositories, there are four main functions content from the DKAN site which are represented in the acronym CRUD.

**CRUD** methodology stands for:

* **C**reate: adding new objects to the repository
* **R**etrieve: provide information about object(s)
* **U**pdate: modify an object's entry
* **D**elete: removes record from the repository

The key features of `dkanr` allow you to perform basic CRUD operations on the catalog.

### Search the catalog with `list_all_nodes()`
While exploring the offerings of a catalog, you can retrive all the nodes in a simple query.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
list_all_nodes()
```

A search query can be built by using the `list_all_nodes()` function, where the function will return information from all the results pages, based on the filters and fields selected. This function takes character vectors for the filters and fields parameters. These results can be returned in JSON format as well as in list format. For example, say we would like to view all the nodes with the title `Florida Bike Lanes` on the demo DKAN site in JSON format.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
list_all_nodes(filters = c(title = 'Florida Bike Lanes'),
           as = 'json')
```

You can also build a query with multiple elements in the filters vector. Using the framework above, you can specify your results even more.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
list_all_nodes(filters = c(title = 'Florida Bike Lanes',
                           type = 'dataset'),
           as = 'list')
```
Combining parameter elements can yield more specific results by selecting a subset of fields to view. In this example, we are only looking at the node IDs and returning the results in list format.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
list_all_nodes(fields = c('nid'),
           filters = c(title = 'Florida Bike Lanes'),
           as = 'json')
```

There are specific fields that will allow you to subset the results. In this case, only node ID, type, and title have been selected.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
list_all_nodes(fields = c('nid', 'type', 'title'),
           filters = c(title = 'Florida Bike Lanes'),
           as = 'json')
```

### Retrieve metadata with `retrieve_node()`
The retrieve_node function creates a GET request to collect metadata information about a specific, existing node. For example, if we were to select information with the node ID of `'35'` with the output format in JSON.
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
retrieve_node(nid ='35',
              as = 'json')
```

### Create a node with `create_node()`

Users can add datasets and resources by creating nodes. Let's say we want to contribute a new JSON resource on a site. We can take our JSON and pass that element to the function call.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
json_code = '{"title" : "Sample Resource",
                    "date" : "Sample Date"}'
create_node(body = json_code)
```

### Update a node with `update_node()`

To update information for an existing node, pass a JSON object. Say we would like to revise the title for node `"200"`, we can accomplish this by passing the updated JSON to the update function.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
json_update = '{"title" : "Sample Resource V.2"}'
update_node(nid = '200',
            body = json_update,
            as = 'list')
```
### Remove a node with `delete_node`
To completely remove a node, you must have the specific node ID when calling the function.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, eval=FALSE}
delete_node(nid ='35',
            as = 'json')
```
